<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulasi Kredit</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">
  <div class="max-w-3xl mx-auto bg-white shadow-xl rounded-xl p-6">
    <h1 class="text-2xl font-bold mb-4 text-center">Simulasi Kredit</h1>

    <!-- Form Input -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
      <div>
        <label class="block text-sm font-medium mb-1">Plafon</label>
        <input id="plafon" type="text" class="w-full border rounded-lg p-2" placeholder="1.000.000">
        <p id="errorPlafon" class="text-red-500 text-xs mt-1 hidden"></p>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">Suku Bunga (% Per Bulan)</label>
        <input id="bunga" type="number" step="0.01" class="w-full border rounded-lg p-2" placeholder="Masukkan suku bunga">
        <p id="rangeInfo" class="text-xs text-gray-500 mt-1"></p>
        <p id="errorBunga" class="text-red-500 text-xs mt-1 hidden"></p>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">Jenis Bunga</label>
        <select id="jenis" class="w-full border rounded-lg p-2">
          <option value="flat">Flat</option>
          <option value="anuitas">Anuitas</option>
          <option value="menurun">Menurun</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">Tenor (Bulan)</label>
        <input id="tenor" type="number" class="w-full border rounded-lg p-2" placeholder="12">
        <p id="errorTenor" class="text-red-500 text-xs mt-1 hidden"></p>
      </div>
    </div>

    <div class="flex justify-center mb-6">
  <button onclick="hitungKredit()" 
    class="bg-[#2E3286] hover:bg-[#24285f] text-white font-medium px-6 py-2 rounded-lg">
    Hitung
  </button>
</div>

    <!-- Hasil -->
    <div id="hasil" class="hidden bg-gray-50 p-4 rounded-lg border">
      <p class="text-sm text-red-600 mb-2">***Perhitungan di bawah belum termasuk biaya Administrasi dan lain-lain</p>
      <h2 class="text-lg font-semibold mb-2">Hasil Simulasi</h2>
      <div class="space-y-1">
        <div class="flex">
          <span class="w-48">Cicilan / Bulan</span><span>:</span>&nbsp;
          <span id="angsuran"></span>
        </div>
        <div class="flex">
          <span class="w-48">Total Bunga</span><span>:</span>&nbsp;
          <span id="totalBunga"></span>
        </div>
        <div class="flex">
          <span class="w-48">Total Pembayaran</span><span>:</span>&nbsp;
          <span id="totalBayar"></span>
        </div>
      </div>
    </div>

    <!-- Tabel -->
    <div id="tabelWrap" class="hidden mt-6">
      <h2 class="text-lg font-semibold mb-2">Tabel Angsuran</h2>
      <div class="overflow-x-auto">
        <table class="min-w-full border border-gray-200 text-sm text-right">
          <thead class="bg-gray-100">
            <tr>
              <th class="border px-2 py-1 text-left">Bulan</th>
              <th class="border px-2 py-1">Angsuran</th>
              <th class="border px-2 py-1">Bunga</th>
              <th class="border px-2 py-1">Pokok</th>
              <th class="border px-2 py-1">Sisa Pinjaman</th>
            </tr>
          </thead>
          <tbody id="tabelBody"></tbody>
        </table>
      </div>
    </div>

    <!-- Footnote -->
    <div class="mt-6 text-xs text-gray-600 italic space-y-1">
      <p>Catatan :</p>
      <p>1. Perhitungan ini hanya merupakan simulasi estimasi dan bukan merupakan penawaran yang mengikat.</p>
      <p>2. Hasil simulasi dapat berbeda dengan perhitungan resmi di kantor BPR sesuai dengan data aktual, biaya administrasi, asuransi, dan ketentuan yang berlaku.</p>
      <p>3. Suku bunga dapat berubah sewaktu-waktu mengikuti kebijakan BPR dan/atau regulasi OJK yang berlaku.</p>
      <p>4. Simulasi tidak memperhitungkan biaya tambahan lain (misalnya denda keterlambatan, provisi, asuransi, pajak, dan biaya lain-lain).</p>
    </div>
  </div>

  <script>
    function fmt(num) {
      return new Intl.NumberFormat('id-ID').format(num);
    }

    // format otomatis saat mengetik plafon
    document.getElementById('plafon').addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, "");
      e.target.value = value ? new Intl.NumberFormat('id-ID').format(value) : "";
    });

    // ubah suku bunga berdasarkan jenis
    document.getElementById('jenis').addEventListener('change', function() {
      let bungaInput = document.getElementById('bunga');
      let rangeInfo = document.getElementById('rangeInfo');

      if (this.value === "anuitas") {
        bungaInput.value = 1.4;
        bungaInput.readOnly = true;
        rangeInfo.innerText = "Bunga anuitas fix: 1.4% per bulan (tidak dapat diubah)";
      } else if (this.value === "flat") {
        bungaInput.value = "";
        bungaInput.readOnly = false;
        bungaInput.placeholder = "0.9 – 1.5";
        rangeInfo.innerText = "Masukkan bunga Flat antara 0.9% – 1.5% per bulan";
      } else if (this.value === "menurun") {
        bungaInput.value = "";
        bungaInput.readOnly = false;
        bungaInput.placeholder = "1 – 1.8";
        rangeInfo.innerText = "Masukkan bunga Menurun antara 1% – 1.8% per bulan";
      }
    });

    // set default awal
    document.getElementById('jenis').dispatchEvent(new Event('change'));

    function clearErrors() {
      document.querySelectorAll("#errorPlafon, #errorBunga, #errorTenor").forEach(el => el.classList.add("hidden"));
    }

    function hitungKredit() {
      clearErrors();

      var plafonStr = document.getElementById('plafon').value.replace(/\./g, "").replace(/,/g, "");
      var pinjaman = parseFloat(plafonStr) || 0;
      var tenor = parseInt(document.getElementById('tenor').value) || 0;
      var bungaBulanan = parseFloat(document.getElementById('bunga').value) || 0;
      var jenis = document.getElementById('jenis').value;

      let valid = true;

      if (pinjaman <= 0) {
        document.getElementById('errorPlafon').innerText = "Plafon harus diisi dengan benar.";
        document.getElementById('errorPlafon').classList.remove("hidden");
        valid = false;
      }

      if (tenor <= 0) {
        document.getElementById('errorTenor').innerText = "Tenor harus lebih dari 0 bulan.";
        document.getElementById('errorTenor').classList.remove("hidden");
        valid = false;
      }

      if (jenis === "flat" && (bungaBulanan < 0.9 || bungaBulanan > 1.5)) {
        document.getElementById('errorBunga').innerText = "Bunga Flat harus 0.9% – 1.5%.";
        document.getElementById('errorBunga').classList.remove("hidden");
        valid = false;
      }
      if (jenis === "menurun" && (bungaBulanan < 1 || bungaBulanan > 1.8)) {
        document.getElementById('errorBunga').innerText = "Bunga Menurun harus 1% – 1.8%.";
        document.getElementById('errorBunga').classList.remove("hidden");
        valid = false;
      }
      if (jenis === "anuitas" && bungaBulanan !== 1.4) {
        document.getElementById('errorBunga').innerText = "Bunga Anuitas fix: 1.4%.";
        document.getElementById('errorBunga').classList.remove("hidden");
        valid = false;
      }

      if (!valid) return;

      bungaBulanan = bungaBulanan / 100;

      var angsuran = 0, totalBayar = 0, totalBunga = 0;

      if (jenis === "flat") {
        var pokok = pinjaman / tenor;
        var bunga = pinjaman * bungaBulanan;
        angsuran = pokok + bunga;
        totalBayar = angsuran * tenor;
        totalBunga = bunga * tenor;
      } else if (jenis === "anuitas") {
        angsuran = pinjaman * (bungaBulanan * Math.pow(1 + bungaBulanan, tenor)) / (Math.pow(1 + bungaBulanan, tenor) - 1);
        totalBayar = angsuran * tenor;
        totalBunga = totalBayar - pinjaman;
      } else if (jenis === "menurun") {
        var pokok = pinjaman / tenor;
        var sisa = pinjaman;
        totalBunga = 0;
        for (var i = 1; i <= tenor; i++) {
          var bunga = sisa * bungaBulanan;
          totalBunga += bunga;
          sisa -= pokok;
        }
        totalBayar = pinjaman + totalBunga;
        angsuran = (pinjaman / tenor) + (pinjaman * bungaBulanan); // cicilan awal
      }

      // Tampilkan hasil ringkas
      document.getElementById('hasil').classList.remove('hidden');
      document.getElementById('angsuran').innerText = "Rp " + fmt(Math.round(angsuran));
      document.getElementById('totalBunga').innerText = "Rp " + fmt(Math.round(totalBunga));
      document.getElementById('totalBayar').innerText = "Rp " + fmt(Math.round(totalBayar));

      // Buat tabel amortisasi
      var tbody = document.getElementById('tabelBody');
      tbody.innerHTML = "";
      var sisa = pinjaman;

      for (var i = 1; i <= tenor; i++) {
        var bunga, pokok;
        if (jenis === "flat") {
          pokok = pinjaman / tenor;
          bunga = pinjaman * bungaBulanan;
          sisa -= pokok;
          angsuran = pokok + bunga;
        } else if (jenis === "anuitas") {
          bunga = sisa * bungaBulanan;
          pokok = angsuran - bunga;
          sisa -= pokok;
        } else if (jenis === "menurun") {
          pokok = pinjaman / tenor;
          bunga = sisa * bungaBulanan;
          angsuran = pokok + bunga;
          sisa -= pokok;
        }

        var row = "<tr>" +
          "<td class='border px-2 py-1 text-left'>" + i + "</td>" +
          "<td class='border px-2 py-1'>" + fmt(Math.round(angsuran)) + "</td>" +
          "<td class='border px-2 py-1'>" + fmt(Math.round(bunga)) + "</td>" +
          "<td class='border px-2 py-1'>" + fmt(Math.round(pokok)) + "</td>" +
          "<td class='border px-2 py-1'>" + fmt(Math.round(sisa > 0 ? sisa : 0)) + "</td>" +
        "</tr>";

        tbody.innerHTML += row;
      }

      document.getElementById('tabelWrap').classList.remove('hidden');
    }
  </script>
</body>
</html>
